<html>
  <head><title>Casein Proof-of-Concept</title></head>
  <body>
    <script type="text/javascript">
      var memory;
      function print_cstr(ptr) {
              const view = new Uint8Array(memory.buffer);
              var str = '';
              while (view[ptr] != 0) {
                      str += String.fromCharCode(view[ptr]);
                      ptr++;
                    }
              console.log(str);
            }
      const imp = {
              env: { loggy: print_cstr },
              wasi_snapshot_preview1: {
                fd_close: () => { console.log("fd_close") },
                fd_seek: () => { console.log("fd_seek") },
                fd_write: () => { console.log("fd_write") },
                proc_exit: () => { throw "oops" }
              },
            };

      fetch('poc/poc')
        .then(response => response.arrayBuffer())
        .then(bytes => WebAssembly.instantiate(bytes, imp))
        .then(obj => obj.instance.exports)
        .then(exp => { memory = exp.memory; exp._start() })
    </script>
  </body>
</html>
